services:
  - type: web
    name: ne-don-energy
    env: php
    buildCommand: |
      # Préparation de l'environnement
      export PATH="/usr/local/bin:$PATH"
      export COMPOSER_ALLOW_SUPERUSER=1
      export COMPOSER_HOME="/tmp/composer"
      # Donner les permissions d'exécution au script
      chmod +x build.sh
      # Exécuter le script
      ./build.sh
    envVars:
      - key: APP_ENV
        value: production
      - key: APP_DEBUG
        value: false
      - key: COMPOSER_MEMORY_LIMIT
        value: -1
      - key: COMPOSER_ALLOW_SUPERUSER
        value: 1
    startCommand: vendor/bin/heroku-php-apache2 -C apache2-render-config.conf public/
    envVars:
      - key: APP_ENV
        value: production
      - key: APP_DEBUG
        value: false
      - key: COMPOSER_MEMORY_LIMIT
        value: -1
      - key: COMPOSER_ALLOW_SUPERUSER
        value: 1
      - key: PHP_VERSION
        value: 8.0.2
      - key: NODE_ENV
        value: production
    healthCheckPath: /
    buildFilter:
      paths:
        - app/**/*.php
        - config/**/*.php
        - public/**/*
        - resources/**/*
        - routes/**/*.php
        - composer.*
        - package.json
